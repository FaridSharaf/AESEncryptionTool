<ui:FluentWindow
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:AESCryptoTool.Views"
        x:Class="AESCryptoTool.Views.MainWindow"
        Title="AES Crypto Tool" Height="950" Width="850"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        WindowCornerPreference="Round"
        Icon="/aes_crypto_tool_icon.png">
    <ui:FluentWindow.Resources>




        <!-- TabItem Style -->
        <Style TargetType="{x:Type TabItem}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Border x:Name="Border" Background="Transparent" 
                                BorderBrush="Transparent" BorderThickness="0,0,0,2" 
                                Padding="20,10">
                            <ContentPresenter x:Name="ContentSite"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"
                                              ContentSource="Header"
                                              RecognizesAccessKey="True"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource AccentPurple}"/>
                                <Setter Property="Foreground" Value="{DynamicResource AccentPurple}"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type TabControl}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <!-- TextBox Style -->
        <!-- TextBox and Label Styles inherited from App.xaml -->



        <!-- CheckBox Style for Dark Theme -->
        <Style TargetType="{x:Type CheckBox}">
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        
        <!-- Hand cursor for all WPF-UI buttons -->
        <Style TargetType="{x:Type ui:Button}" BasedOn="{StaticResource {x:Type ui:Button}}">
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid x:Name="MainGrid" AllowDrop="True" 
          DragEnter="MainGrid_DragEnter" DragLeave="MainGrid_DragLeave" 
          DragOver="MainGrid_DragOver" Drop="MainGrid_Drop">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- TitleBar -->
            <RowDefinition Height="Auto"/>  <!-- Keys Config -->
            <RowDefinition Height="Auto"/>  <!-- Navigation -->
            <RowDefinition Height="*"/>     <!-- Content -->
            <RowDefinition Height="Auto"/>  <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- TitleBar -->
        <ui:TitleBar Grid.Row="0" Title="AES Crypto Tool" Icon="/aes_crypto_tool_icon.png">
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <ui:Button x:Name="PinButton" 
                               ToolTip="Always on Top"
                               Appearance="Transparent"
                               Click="PinButton_Click">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="Pin24"/>
                        </ui:Button.Icon>
                    </ui:Button>
                    <ui:Button x:Name="HelpButton"
                               ToolTip="Help &amp; About"
                               Appearance="Transparent"
                               Click="HelpButton_Click" Margin="4,0,0,0">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="QuestionCircle24"/>
                        </ui:Button.Icon>
                    </ui:Button>
                </StackPanel>
            </ui:TitleBar.Header>
        </ui:TitleBar>

        <!-- Drop Overlay (hidden by default) -->
        <Border x:Name="DropOverlay" Grid.RowSpan="5" Panel.ZIndex="999"
                Background="{DynamicResource AccentBlue}" Opacity="0.5" CornerRadius="12" Visibility="Collapsed"
                BorderBrush="{DynamicResource AccentBlue}" BorderThickness="3">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="ðŸ“¥" FontSize="48" HorizontalAlignment="Center" FontFamily="Segoe UI Emoji"/>
                <TextBlock Text="Drop file to load in Batch" FontSize="18" 
                           Foreground="White" FontWeight="SemiBold"
                           HorizontalAlignment="Center" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Key/IV Section and Settings -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Expander Grid.Column="0" IsExpanded="False" Margin="10,5,10,0"
                      Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                <Expander.Header>
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Key24" FontSize="16" Margin="0,0,8,0"/>
                        <TextBlock Text="Key/IV Configuration (Plaintext)" VerticalAlignment="Center"/>
                    </StackPanel>
                </Expander.Header>
                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,10,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Profile Selector -->
                        <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="Profile:" VerticalAlignment="Center" Margin="0,0,10,0" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            <ComboBox x:Name="ProfileComboBox" Width="200" Margin="0,0,10,0"
                                      DisplayMemberPath="Name" SelectedValuePath="Id"
                                      SelectionChanged="ProfileComboBox_SelectionChanged"/>
                            
                            <ui:Button x:Name="AddProfileButton" Content="New" 
                                    Icon="{ui:SymbolIcon Symbol=Add24}"
                                    Appearance="Secondary" 
                                    Padding="10,5" Margin="0,0,5,0"
                                    Click="AddProfileButton_Click" ToolTip="Create new profile"/>
                            
                            <ui:Button x:Name="DeleteProfileButton"
                                    Icon="{ui:SymbolIcon Symbol=Delete24}"
                                    Appearance="Secondary" 
                                    Padding="10,5" 
                                    Click="DeleteProfileButton_Click" ToolTip="Delete current profile"/>
                        </StackPanel>


                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,10,10">
                            <Label Content="Key (16/24/32 chars):"/>
                            <Grid>
                                <TextBox x:Name="KeyTextBox" Style="{StaticResource InputTextBox}"
                                     TextChanged="KeyTextBox_TextChanged"/>
                                <ui:Button x:Name="KeyShowButton" Appearance="Transparent"
                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                    Width="35" Margin="0,5,8,5" Click="KeyShowButton_Click"
                                    ToolTip="Show/Hide Key">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Eye24"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                            </Grid>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,0,0,10">
                            <Label Content="IV (16 chars):"/>
                            <Grid>
                                <TextBox x:Name="IVTextBox" Style="{StaticResource InputTextBox}"
                                     TextChanged="IVTextBox_TextChanged"/>
                                <ui:Button x:Name="IVShowButton" Appearance="Transparent"
                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                    Width="35" Margin="0,5,8,5" Click="IVShowButton_Click"
                                    ToolTip="Show/Hide IV">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Eye24"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                            </Grid>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right">
                            <ui:Button Content="Reset" Appearance="Secondary"
                                Click="ResetKeysButton_Click" Margin="0,0,5,0"
                                ToolTip="Reset to default keys">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="ArrowCounterclockwise24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                            <ui:Button Content="Set Default" Appearance="Secondary"
                                Click="SetDefaultKeysButton_Click" Margin="5,0,5,0"
                                ToolTip="Set current keys as new default">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Pin24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                            <ui:Button Content="Save" Appearance="Primary"
                                Background="{DynamicResource AccentGreen}" Click="SaveKeysButton_Click"
                                ToolTip="Save keys to encrypted config" Margin="5,0,0,0">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Save24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Expander>
        </Grid>

        <!-- Navigation Bar -->
        <Border Grid.Row="2" Background="{DynamicResource LayerFillColorDefaultBrush}" Margin="0,0,0,10" CornerRadius="8" Padding="5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <RadioButton x:Name="NavOperations" Content="Operations" Tag="Operations" IsChecked="True"
                             Style="{StaticResource ToggleButtonTheme}" Checked="NavTab_Checked"/>
                <RadioButton x:Name="NavBatch" Content="Batch" Tag="Batch"
                             Style="{StaticResource ToggleButtonTheme}" Checked="NavTab_Checked"/>
                <RadioButton x:Name="NavHistory" Content="History" Tag="History"
                             Style="{StaticResource ToggleButtonTheme}" Checked="NavTab_Checked"/>
                <RadioButton x:Name="NavBookmarks" Content="Bookmarks" Tag="Bookmarks"
                             Style="{StaticResource ToggleButtonTheme}" Checked="NavTab_Checked"/>
                <RadioButton x:Name="NavSettings" Content="Settings" Tag="Settings"
                             Style="{StaticResource ToggleButtonTheme}" Checked="NavTab_Checked"/>
            </StackPanel>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Row="3" Margin="0,10,0,10">
            <!-- Operations Section -->
            <Grid x:Name="OperationsSection">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="20,0,20,0">
                    <Grid Margin="0,15,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Encrypt/Decrypt Panels -->
                        <RowDefinition Height="Auto"/> <!-- Recent Items -->
                    </Grid.RowDefinitions>

                    <!-- Encrypt/Decrypt Panels -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Encrypt Panel -->
                        <Border Grid.Column="0" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                    <ui:SymbolIcon Symbol="LockClosed24" FontSize="20" Foreground="{DynamicResource AccentGreen}" Margin="0,0,8,0"/>
                                    <TextBlock Text="ENCRYPT" FontWeight="Bold" FontSize="18"
                                               Foreground="{DynamicResource AccentGreen}" VerticalAlignment="Center"/>
                                    <CheckBox x:Name="EncryptAutoDetectCheckBox" Content="Auto-detect" 
                                              IsChecked="True" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1">
                                    <Label Content="Input (Plain Text):" FontSize="13"/>
                                    <Grid>
                                        <TextBox x:Name="EncryptInputTextBox" Style="{StaticResource InputTextBox}"
                                                 TextChanged="EncryptInputTextBox_TextChanged"
                                                 KeyDown="EncryptInputTextBox_KeyDown"
                                                 Height="45"/>
                                        <ui:Button Appearance="Transparent"
                                                HorizontalAlignment="Right" VerticalAlignment="Center"
                                                Width="35" Margin="0,5,8,5" Click="EncryptPasteButton_Click"
                                                ToolTip="Paste from clipboard">
                                            <ui:Button.Icon>
                                                <ui:SymbolIcon Symbol="ClipboardPaste24"/>
                                            </ui:Button.Icon>
                                        </ui:Button>
                                    </Grid>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,10">
                                    <ui:Button Content="Encrypt" Appearance="Primary"
                                            Click="EncryptButton_Click" Margin="0,0,8,0">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="LockClosed24"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                    <ui:Button Content="Clear" Appearance="Secondary"
                                            Click="EncryptClearButton_Click" Margin="0,0,12,0"/>
                                    <ui:Button x:Name="EncryptFavoriteButton" Appearance="Transparent"
                                            Click="EncryptFavoriteButton_Click"
                                            ToolTip="Add to bookmarks">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="Bookmark24" Filled="False"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                </StackPanel>

                                <StackPanel Grid.Row="3">
                                    <Label Content="Output (Encrypted):" FontSize="13"/>
                                    <TextBox x:Name="EncryptOutputTextBox" Style="{StaticResource InputTextBox}"
                                             IsReadOnly="True" Height="45"
                                             MouseDoubleClick="EncryptOutputTextBox_MouseDoubleClick"
                                             ToolTip="Double-click to copy"/>
                                </StackPanel>

                                <StackPanel Grid.Row="4" Margin="0,10,0,0">
                                    <Label Content="Note (optional):" FontSize="13"/>
                                    <TextBox x:Name="EncryptNoteTextBox" Style="{StaticResource InputTextBox}" Height="45"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Decrypt Panel -->
                        <Border Grid.Column="2" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                    <ui:SymbolIcon Symbol="LockOpen24" FontSize="20" Foreground="{DynamicResource AccentPurple}" Margin="0,0,8,0"/>
                                    <TextBlock Text="DECRYPT" FontWeight="Bold" FontSize="18"
                                               Foreground="{DynamicResource AccentPurple}" VerticalAlignment="Center"/>
                                    <CheckBox x:Name="DecryptAutoDetectCheckBox" Content="Auto-detect" 
                                              IsChecked="True" VerticalAlignment="Center" Margin="20,0,0,0"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1">
                                    <Label Content="Input (Encrypted Text):" FontSize="13"/>
                                    <Grid>
                                        <TextBox x:Name="DecryptInputTextBox" Style="{StaticResource InputTextBox}"
                                                 TextChanged="DecryptInputTextBox_TextChanged"
                                                 KeyDown="DecryptInputTextBox_KeyDown"
                                                 Height="45"/>
                                        <ui:Button Appearance="Transparent"
                                                HorizontalAlignment="Right" VerticalAlignment="Center"
                                                Width="35" Margin="0,5,8,5" Click="DecryptPasteButton_Click"
                                                ToolTip="Paste from clipboard">
                                            <ui:Button.Icon>
                                                <ui:SymbolIcon Symbol="ClipboardPaste24"/>
                                            </ui:Button.Icon>
                                        </ui:Button>
                                    </Grid>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,10">
                                    <ui:Button Content="Decrypt" Appearance="Primary"
                                            Click="DecryptButton_Click" Margin="0,0,8,0">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="LockOpen24"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                    <ui:Button Content="Clear" Appearance="Secondary"
                                            Click="DecryptClearButton_Click" Margin="0,0,12,0"/>
                                    <ui:Button x:Name="DecryptFavoriteButton" Appearance="Transparent"
                                            Click="DecryptFavoriteButton_Click"
                                            ToolTip="Add to bookmarks">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="Bookmark24" Filled="False"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                </StackPanel>

                                <StackPanel Grid.Row="3">
                                    <Label Content="Output (Decrypted):" FontSize="13"/>
                                    <TextBox x:Name="DecryptOutputTextBox" Style="{StaticResource InputTextBox}"
                                             IsReadOnly="True" Height="45"
                                             MouseDoubleClick="DecryptOutputTextBox_MouseDoubleClick"
                                             ToolTip="Double-click to copy"/>
                                </StackPanel>

                                <StackPanel Grid.Row="4" Margin="0,10,0,0">
                                    <Label Content="Note (optional):" FontSize="13"/>
                                    <TextBox x:Name="DecryptNoteTextBox" Style="{StaticResource InputTextBox}" Height="45"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Recent Items Panel (Moved here) -->
                    <Border Grid.Row="1" Margin="0,20,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="âš¡ Recent (click to copy)" FontWeight="SemiBold" FontSize="12" FontFamily="Segoe UI Emoji"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,8"/>
                            <ItemsControl x:Name="RecentItemsControl" Grid.Row="1">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <ui:Button Appearance="Secondary" 
                                                Click="RecentItemButton_Click" Tag="{Binding}"
                                                MaxWidth="220" Margin="0,0,8,8" Padding="12,8"
                                                ToolTip="{Binding Output}">
                                            <TextBlock Text="{Binding Converter={x:Static local:NoteOrOutputConverter.Instance}}" 
                                                       TextTrimming="CharacterEllipsis" 
                                                       FontFamily="Consolas" FontSize="12" MaxWidth="180"/>
                                        </ui:Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Border>
                </Grid>
                </ScrollViewer>
            </Grid>

            <!-- Batch Section -->
            <Grid x:Name="BatchSection" Visibility="Collapsed">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,10,0">
                <Border x:Name="BatchDropBorder" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20" Margin="0,15,0,0"
                        AllowDrop="True" Drop="BatchBorder_Drop" DragOver="BatchBorder_DragOver">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header with Row Count -->
                        <Grid Grid.Row="0" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="DocumentMultiple24" FontSize="18" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,8,0"/>
                                <TextBlock Text="Batch Processing" FontWeight="Bold" FontSize="16"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                            <TextBlock x:Name="BatchRowCountText" Grid.Column="2" Text="" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="13"
                                       VerticalAlignment="Center"/>
                        </Grid>

                        <!-- File Selection -->
                        <Grid Grid.Row="1" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="BatchFilePathTextBox" Grid.Column="0" 
                                     Style="{StaticResource InputTextBox}" Height="45"
                                     IsReadOnly="True" TextAlignment="Center" VerticalContentAlignment="Center"
                                     Text="Drop file here or click Browse..."
                                     Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            <ui:Button Grid.Column="1" Content="Browse" 
                                    Appearance="Primary" 
                                    Margin="10,0,0,0" Padding="15,8" Height="45"
                                    Click="BrowseBatchFile_Click">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="FolderOpen24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </Grid>

                        <!-- Options Row -->
                        <Grid Grid.Row="2" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <CheckBox x:Name="BatchHasHeaderCheckBox" Grid.Column="0" 
                                      Content="File has header row" IsChecked="True"
                                      Foreground="{DynamicResource TextFillColorPrimaryBrush}" 
                                      VerticalAlignment="Center" Margin="0,0,20,0"
                                      Checked="BatchHasHeader_Changed" Unchecked="BatchHasHeader_Changed"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Column:" Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                           VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="BatchColumnComboBox" Width="180" Height="38"
                                          IsEnabled="False" SelectionChanged="BatchColumn_SelectionChanged"/>
                            </StackPanel>

                            <TextBlock x:Name="BatchPatternLabel" Grid.Column="2" Text="Pattern:" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                       VerticalAlignment="Center" Margin="20,0,10,0"/>
                            <TextBox x:Name="BatchPatternTextBox" Grid.Column="3" 
                                     Style="{StaticResource InputTextBox}" Height="38" VerticalContentAlignment="Center"
                                     Text=".*PhoneNumber.*" ToolTip="Regex pattern to match column name"/>
                        </Grid>

                        <!-- Operation Selection -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="Operation:" Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                       VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <RadioButton x:Name="BatchEncryptRadio" Content="Encrypt" 
                                         IsChecked="True" Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                         GroupName="BatchOperation" Margin="0,0,20,0"/>
                            <RadioButton x:Name="BatchDecryptRadio" Content="Decrypt" 
                                         Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                         GroupName="BatchOperation"/>
                        </StackPanel>

                        <!-- Output Path -->
                        <Grid Grid.Row="4" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Output:" Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox x:Name="BatchOutputPathTextBox" Grid.Column="1" 
                                     Style="{StaticResource InputTextBox}" Height="45" VerticalContentAlignment="Center"
                                     Text="(auto-generated)"
                                     Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                     TextChanged="BatchOutputPath_TextChanged"/>
                            <ui:Button Grid.Column="2" Appearance="Secondary" 
                                    Margin="10,0,0,0" Padding="10,5" Width="45" Height="45"
                                    Click="BrowseOutputFile_Click" ToolTip="Choose output location">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="FolderOpen24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </Grid>

                        <!-- Preview Panel / Log Panel -->
                        <Border x:Name="BatchPreviewBorder" Grid.Row="5" Margin="0,0,0,15" 
                                Background="{DynamicResource LayerFillColorDefaultBrush}" CornerRadius="8" Padding="10"
                                Visibility="Collapsed">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                    <ui:SymbolIcon Symbol="DocumentBulletList24" FontSize="14" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,6,0"/>
                                    <TextBlock x:Name="BatchPreviewHeader" Text="Preview"
                                               Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                </StackPanel>
                                <DataGrid x:Name="BatchPreviewDataGrid" Grid.Row="1" 
                                          AutoGenerateColumns="False" IsReadOnly="True"
                                          CanUserAddRows="False"
                                          Background="Transparent" BorderThickness="0"
                                          HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                          HorizontalGridLinesBrush="{DynamicResource ControlStrokeColorDefaultBrush}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="#" Binding="{Binding RowNumber}" Width="40"/>
                                        <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>

                        <!-- Progress Section -->
                        <Grid Grid.Row="6" Margin="0,0,0,15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ProgressBar x:Name="BatchProgressBar" Grid.Row="0" 
                                         Height="20" Minimum="0" Maximum="100" Value="0"
                                         Background="{DynamicResource LayerFillColorDefaultBrush}"
                                         Foreground="{DynamicResource AccentBlue}"/>
                            <TextBlock x:Name="BatchProgressText" Grid.Row="1" 
                                       Text="Ready to process" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center" Margin="0,5,0,0"/>
                        </Grid>

                        <!-- Summary (hidden until processing complete) -->
                        <Border x:Name="BatchSummaryBorder" Grid.Row="7" 
                                Background="{DynamicResource LayerFillColorDefaultBrush}" 
                                CornerRadius="8" Padding="15" Visibility="Collapsed">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="BatchSummaryText" Grid.Column="0"
                                         Background="Transparent" BorderThickness="0"
                                         Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                         TextWrapping="Wrap" IsReadOnly="True"
                                         VerticalScrollBarVisibility="Auto"/>
                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                    <ui:Button Appearance="Secondary"
                                            Margin="0,0,0,5" Padding="8,5"
                                            Click="CopyBatchSummary_Click" ToolTip="Copy summary">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="Copy24"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                    <ui:Button Appearance="Secondary"
                                            Padding="8,5"
                                            Click="OpenBatchOutputFolder_Click" ToolTip="Open output folder">
                                        <ui:Button.Icon>
                                            <ui:SymbolIcon Symbol="FolderOpen24"/>
                                        </ui:Button.Icon>
                                    </ui:Button>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Row="8" Orientation="Horizontal" 
                                    HorizontalAlignment="Right" Margin="0,15,0,0">
                            <ui:Button x:Name="BatchResetButton" Content="Clear" 
                                    Appearance="Secondary" 
                                    Padding="15,10" Margin="0,0,10,0" Width="130" Height="45"
                                    Click="BatchReset_Click">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Delete24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                            <ui:Button x:Name="BatchCancelButton" Content="Cancel" 
                                    Appearance="Secondary" 
                                    Padding="15,10" Margin="0,0,10,0" Width="130" Height="45"
                                    Foreground="{DynamicResource AccentRed}"
                                    BorderBrush="{DynamicResource AccentRed}" BorderThickness="1"
                                    IsEnabled="False" Click="BatchCancel_Click">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Dismiss24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                            <ui:Button x:Name="BatchProcessButton" Content="Process" 
                                    Appearance="Primary" 
                                    Padding="15,10" Width="130" Height="45" IsEnabled="False"
                                    Click="BatchProcess_Click">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Play24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </StackPanel>
                    </Grid>

                </Border>
                </ScrollViewer>
            </Grid>

            <!-- History Section -->
            <Grid x:Name="HistorySection" Visibility="Collapsed">
                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="15" Margin="0,15,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="History24" FontSize="18" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,8,0"/>
                                <TextBlock x:Name="HistoryLabel" Text="History" FontWeight="Bold" FontSize="14"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}" VerticalAlignment="Center"
                                           Cursor="Hand" MouseLeftButtonDown="HistoryLabel_Click"
                                           ToolTip="Click to show all history"/>
                            </StackPanel>

                            <Grid Grid.Column="1" Margin="20,0">
                                <TextBox x:Name="HistorySearchTextBox" Style="{StaticResource InputTextBox}" Height="35"
                                         TextChanged="HistorySearchTextBox_TextChanged" Padding="30,8,8,8"
                                         ToolTip="Search history by input, output, or note"/>
                                <ui:SymbolIcon Symbol="Search24" IsHitTestVisible="False" 
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                           HorizontalAlignment="Left" VerticalAlignment="Center"
                                           Margin="12,0,0,0" FontSize="16"/>
                            </Grid>

                            <ui:Button x:Name="ClearHistoryButton" Grid.Column="2" Content="Clear History" Appearance="Secondary"
                                    Click="ClearHistoryButton_Click" ToolTip="Delete all history entries (bookmarks preserved)"
                                    Foreground="{DynamicResource AccentRed}" Padding="12,8">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Delete24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </Grid>

                        <DataGrid x:Name="HistoryDataGrid" Grid.Row="1" 
                                  AutoGenerateColumns="False" IsReadOnly="False"
                                  SelectionMode="Single" 
                                  MouseDoubleClick="HistoryDataGrid_MouseDoubleClick"
                                  CellEditEnding="HistoryDataGrid_CellEditEnding"
                                  Background="Transparent" BorderThickness="0"
                                  RowBackground="{DynamicResource SubtleFillColorTransparentBrush}"
                                  AlternatingRowBackground="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  CanUserResizeRows="False"
                                  CanUserAddRows="False"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="{x:Type DataGridColumnHeader}">
                                    <Setter Property="Background" Value="{DynamicResource HeaderBg}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type DataGridColumnHeader}">
                                                <Grid>
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            Padding="8,10">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <Thumb x:Name="PART_RightHeaderGripper" HorizontalAlignment="Right" 
                                                           Width="5" Cursor="SizeWE" Background="Transparent">
                                                        <Thumb.Template>
                                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                                <Border Background="Transparent" Padding="{TemplateBinding Padding}"/>
                                                            </ControlTemplate>
                                                        </Thumb.Template>
                                                    </Thumb>
                                                    <Rectangle Width="1" HorizontalAlignment="Right" Fill="{DynamicResource ControlStrokeColorDefaultBrush}" 
                                                               SnapsToDevicePixels="True" IsHitTestVisible="False"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="{x:Type DataGridRow}">
                                    <Setter Property="Height" Value="40"/>
                                    <Style.Triggers>
                                        <!-- Triggers removed to rely on Cell selection for visibility -->
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="{x:Type DataGridCell}">
                                    <Setter Property="Padding" Value="12,8"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                    <Setter Property="VerticalAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type DataGridCell}">
                                                <Border Background="{TemplateBinding Background}" 
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Width="40" CanUserResize="False">
                                    <DataGridTemplateColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <CheckBox x:Name="HistorySelectAllCheckBox" 
                                                      Checked="HistorySelectAll_Checked" 
                                                      Unchecked="HistorySelectAll_Unchecked"
                                                      ToolTip="Select All"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.HeaderTemplate>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" 
                                                      Click="HistoryItemCheckBox_Click"
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Time" Binding="{Binding Timestamp, StringFormat=\{0:MM/dd HH:mm\}}" 
                                            Width="90" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Op" Binding="{Binding Operation}" Width="70" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Input" Binding="{Binding Input}" Width="*" MinWidth="100" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Input}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Output" Binding="{Binding Output}" Width="*" MinWidth="100" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Output}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Note" Binding="{Binding Note}" Width="100" MinWidth="60" IsReadOnly="False">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Note}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="{x:Type TextBox}">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Bookmark24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button 
                                                    FontSize="18" Padding="0" BorderThickness="0"
                                                    Appearance="Transparent" Foreground="{DynamicResource AccentYellow}"
                                                    Click="HistoryFavoriteButton_Click"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    Tag="{Binding}">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Bookmark24" Filled="{Binding IsFavorite}" FontSize="18"/>
                                                </ui:Button.Icon>
                                                <Button.Style>
                                                    <Style TargetType="{x:Type ui:Button}" BasedOn="{StaticResource {x:Type ui:Button}}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                                <Setter Property="ToolTip" Value="Remove bookmark"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsFavorite}" Value="False">
                                                                <Setter Property="ToolTip" Value="Add to bookmarks"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Copy24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button Appearance="Transparent" Padding="0" BorderThickness="0"
                                                    Click="HistoryCopyButton_Click" Tag="{Binding}"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    ToolTip="Copy output">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Copy24" FontSize="16"/>
                                                </ui:Button.Icon>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Delete24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button Appearance="Transparent" Padding="0" BorderThickness="0"
                                                    Foreground="{DynamicResource AccentRed}"
                                                    Click="HistoryDeleteButton_Click" Tag="{Binding}"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    ToolTip="Delete this item permanently">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Delete24" FontSize="16"/>
                                                </ui:Button.Icon>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </Grid>

            <!-- Bookmarks Section -->
            <Grid x:Name="BookmarksSection" Visibility="Collapsed">
                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="15" Margin="0,15,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Bookmark24" FontSize="18" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,8,0"/>
                                <TextBlock Text="Bookmarks" FontWeight="Bold" FontSize="14"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}" VerticalAlignment="Center"/>
                            </StackPanel>

                            <Grid Grid.Column="1" Margin="20,0">
                                <TextBox x:Name="BookmarksSearchTextBox" Style="{StaticResource InputTextBox}" Height="35"
                                         TextChanged="BookmarksSearchTextBox_TextChanged" Padding="30,8,8,8"
                                         ToolTip="Search bookmarks by input, output, or note"/>
                                <ui:SymbolIcon Symbol="Search24" IsHitTestVisible="False" 
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                           HorizontalAlignment="Left" VerticalAlignment="Center"
                                           Margin="12,0,0,0" FontSize="16"/>
                            </Grid>

                            <ui:Button x:Name="ClearBookmarksButton" Grid.Column="2" Content="Clear Bookmarks" Appearance="Secondary"
                                    Click="ClearBookmarksButton_Click" ToolTip="Remove all bookmarks"
                                    Foreground="{DynamicResource AccentRed}" Padding="12,8">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="Delete24"/>
                                </ui:Button.Icon>
                            </ui:Button>
                        </Grid>
                        <!-- Bookmarks DataGrid -->
                        <DataGrid x:Name="BookmarksDataGrid" Grid.Row="1" 
                                  AutoGenerateColumns="False" IsReadOnly="False"
                                  SelectionMode="Single" 
                                  MouseDoubleClick="HistoryDataGrid_MouseDoubleClick"
                                  CellEditEnding="HistoryDataGrid_CellEditEnding"
                                  Background="Transparent" BorderThickness="0"
                                  RowBackground="{DynamicResource SubtleFillColorTransparentBrush}"
                                  AlternatingRowBackground="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  CanUserResizeRows="False"
                                  CanUserAddRows="False"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                                  
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="{x:Type DataGridColumnHeader}">
                                    <Setter Property="Background" Value="{DynamicResource HeaderBg}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type DataGridColumnHeader}">
                                                <Grid>
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            Padding="8,10">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <Thumb x:Name="PART_RightHeaderGripper" HorizontalAlignment="Right" 
                                                           Width="5" Cursor="SizeWE" Background="Transparent">
                                                        <Thumb.Template>
                                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                                <Border Background="Transparent" Padding="{TemplateBinding Padding}"/>
                                                            </ControlTemplate>
                                                        </Thumb.Template>
                                                    </Thumb>
                                                    <Rectangle Width="1" HorizontalAlignment="Right" Fill="{DynamicResource ControlStrokeColorDefaultBrush}" 
                                                               SnapsToDevicePixels="True" IsHitTestVisible="False"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>

                            <DataGrid.RowStyle>
                                <Style TargetType="{x:Type DataGridRow}">
                                    <Setter Property="Height" Value="40"/>
                                </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.CellStyle>
                                <Style TargetType="{x:Type DataGridCell}">
                                    <Setter Property="Padding" Value="12,8"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                    <Setter Property="VerticalAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type DataGridCell}">
                                                <Border Background="{TemplateBinding Background}" 
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Time" Binding="{Binding Timestamp, StringFormat=\{0:MM/dd HH:mm\}}" 
                                                    Width="90" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Op" Binding="{Binding Operation}" Width="70" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Input" Binding="{Binding Input}" Width="*" MinWidth="100" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Input}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Output" Binding="{Binding Output}" Width="*" MinWidth="100" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Output}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Note" Binding="{Binding Note}" Width="100" MinWidth="60" IsReadOnly="False">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="{x:Type TextBlock}">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Note}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="{x:Type TextBox}">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Bookmark24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button 
                                                    FontSize="18" Padding="0" BorderThickness="0"
                                                    Appearance="Transparent" Foreground="{DynamicResource AccentYellow}"
                                                    Click="HistoryFavoriteButton_Click"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    Tag="{Binding}">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Bookmark24" Filled="{Binding IsFavorite}" FontSize="18"/>
                                                </ui:Button.Icon>
                                                <Button.Style>
                                                    <Style TargetType="{x:Type ui:Button}" BasedOn="{StaticResource {x:Type ui:Button}}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                                <Setter Property="ToolTip" Value="Remove bookmark"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsFavorite}" Value="False">
                                                                <Setter Property="ToolTip" Value="Add to bookmarks"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Copy24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button Appearance="Transparent" Padding="0" BorderThickness="0"
                                                    Click="HistoryCopyButton_Click" Tag="{Binding}"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    ToolTip="Copy output">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Copy24" FontSize="16"/>
                                                </ui:Button.Icon>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Width="50" MinWidth="50" MaxWidth="50" CanUserResize="False">
                                    <DataGridTemplateColumn.Header>
                                        <ui:SymbolIcon Symbol="Delete24" FontSize="16"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ui:Button Appearance="Transparent" Padding="0" BorderThickness="0"
                                                    Foreground="{DynamicResource AccentRed}"
                                                    Click="HistoryDeleteButton_Click" Tag="{Binding}"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"
                                                    ToolTip="Delete this item permanently">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Delete24" FontSize="16"/>
                                                </ui:Button.Icon>
                                            </ui:Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </Grid>

            <!-- Settings Section -->
            <!-- Settings Section -->
            <Grid x:Name="SettingsSection" Visibility="Collapsed">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,0,20,0">
                    <StackPanel Margin="0,15,0,20">
                        <TextBlock Text="Settings" FontSize="24" FontWeight="SemiBold" 
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,15"/>

                        <!-- Behavior -->
                        <TextBlock Text="Behavior" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                            <StackPanel>
                                <CheckBox x:Name="AutoCopyCheckBox" Content="Auto-copy result to clipboard" Margin="0,0,0,8"
                                          Checked="Setting_Changed" Unchecked="Setting_Changed"/>
                                <CheckBox x:Name="AutoDetectCheckBox" Content="Auto-detect input type (encrypted/plaintext)"
                                          Checked="Setting_Changed" Unchecked="Setting_Changed"/>
                            </StackPanel>
                        </Border>

                        <!-- Appearance -->
                        <TextBlock Text="Appearance" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <Label Content="Theme:" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="SettingsThemeComboBox" HorizontalAlignment="Stretch" Margin="0,0,0,15"
                                              SelectionChanged="SettingsTheme_SelectionChanged"/>
                                    
                                    <Label Content="Recent Items Count (Max 20):" Margin="0,0,0,5"/>
                                    <TextBox x:Name="SettingsRecentCountTextBox" Style="{StaticResource InputTextBox}"
                                             TextChanged="SettingsRecentCount_TextChanged"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                    <Label Content="Font:" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="SettingsFontComboBox" HorizontalAlignment="Stretch" Margin="0,0,0,15"
                                              SelectionChanged="SettingsFont_SelectionChanged">
                                        <ComboBoxItem Content="Segoe UI" Tag="Segoe UI"/>
                                        <ComboBoxItem Content="Inter" Tag="Inter"/>
                                        <ComboBoxItem Content="Roboto" Tag="Roboto"/>
                                        <ComboBoxItem Content="Open Sans" Tag="Open Sans"/>
                                        <ComboBoxItem Content="Consolas" Tag="Consolas"/>
                                        <ComboBoxItem Content="Cascadia Code" Tag="Cascadia Code"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Storage -->
                        <TextBlock Text="Storage Limits" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,15">
                                    <ui:SymbolIcon Symbol="Warning24" FontSize="14" Margin="0,0,8,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="Items beyond these limits will be auto-deleted" 
                                               Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,10,0">
                                    <Label Content="Max History Records:" Margin="0,0,0,5"/>
                                    <TextBox x:Name="SettingsMaxHistoryTextBox" Style="{StaticResource InputTextBox}"
                                             TextChanged="SettingsMaxHistory_TextChanged"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,0,0,0">
                                    <Label Content="Max Bookmark Records:" Margin="0,0,0,5"/>
                                    <TextBox x:Name="SettingsMaxBookmarksTextBox" Style="{StaticResource InputTextBox}"
                                             TextChanged="SettingsMaxBookmarks_TextChanged"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Data Management -->
                        <TextBlock Text="Data Management" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal">
                                <ui:Button Content="Export Data" Appearance="Secondary" 
                                        Click="ExportDataButton_Click" Margin="0,0,10,0" ToolTip="Backup History and Bookmarks">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Save24"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                                <ui:Button Content="Import Data" Appearance="Secondary" 
                                        Click="ImportDataButton_Click" ToolTip="Restore History and Bookmarks">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="FolderOpen24"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                            </StackPanel>
                        </Border>

                        <!-- System & Window -->
                        <TextBlock Text="System &amp; Window" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                        <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                            <StackPanel>
                                <CheckBox x:Name="MinimizeToTrayCheckBox" Content="Minimize to system tray" Margin="0,0,0,8"
                                          Checked="Setting_Changed" Unchecked="Setting_Changed"/>
                                <CheckBox x:Name="CloseToTrayCheckBox" Content="Close to system tray" Margin="0,0,0,8"
                                          Checked="Setting_Changed" Unchecked="Setting_Changed"/>
                                <CheckBox x:Name="AlwaysOnTopCheckBox" Content="Always on Top"
                                          Checked="AlwaysOnTop_Changed" Unchecked="AlwaysOnTop_Changed"/>
                            </StackPanel>
                        </Border>

                        <TextBlock x:Name="SettingsStatusText" Text="" Foreground="{DynamicResource AccentGreen}" 
                                   HorizontalAlignment="Right" Margin="0,0,5,0" Height="20"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
            <!-- Operations Tab -->


            <!-- Batch Processing Tab -->


            <!-- History Tab -->


        <!-- Status Bar (Moved to Row 2) -->
        <Border Grid.Row="4" Background="{DynamicResource LayerFillColorDefaultBrush}" CornerRadius="6" 
                Padding="15,10" Margin="0,10,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusTextBlock" Text="âœ“ Ready" FontSize="13"
                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
